very ugly math, there must be a simpler way
